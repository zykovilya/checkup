<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Диетологическая анкета</title>
</head>
<body>

<div class="container">
  <form class="form-horizontal" action="{{TMP_SERVER_URL}}/msa/api/products/questions/success.html" method="post" >
    <input type="hidden" name="personId" />
    <input type="hidden" name="productId" />
    <input type="hidden" name="productOrderId" />



    <div class="input-group custom-validation">
      <div class="title">Сколько у Вас основных приемов пищи в день?</div>
      <div class="question" id="question1" onchange="saveCookie()">
        <label class="radio-container"><input name="Сколько у Вас основных приемов пищи в день?" value="1 раз в день" type="radio" /><span class="checkmark"></span>1 раз в день</label>
        <label class="radio-container"><input name="Сколько у Вас основных приемов пищи в день?" value="2 раза в день" type="radio" /><span class="checkmark"></span>2 раза в день</label>
        <label class="radio-container"><input name="Сколько у Вас основных приемов пищи в день?" value="3 раза в день" type="radio"/><span class="checkmark"></span>3 раза в день</label>
        <label class="radio-container"><input name="Сколько у Вас основных приемов пищи в день?" value="4 раза в день" type="radio" /><span class="checkmark"></span>4 раза в день</label>
        <label class="radio-container"><input name="Сколько у Вас основных приемов пищи в день?" value="Более 4 раз в день" type="radio" /><span class="checkmark"></span>Более 4 раз в день</label>
      </div>
    </div>

    <div class="input-group custom-validation">
      <div class="title">Придерживаетесь ли вы какого-то определённого стиля питания (несколько вариантов ответа)?</div>
      <div class="question" id="question2" onchange="saveCookie()">
        <label class="checkbox-container"><input name="Придерживаетесь ли вы какого-то определённого стиля питания?" value="Вегетарианство" type="checkbox" /><span class="checkmark"></span>Вегетарианство</label>
        <label class="checkbox-container"><input name="Придерживаетесь ли вы какого-то определённого стиля питания?" value="Веганство" type="checkbox" /><span class="checkmark"></span>Веганство</label>
        <label class="checkbox-container"><input name="Придерживаетесь ли вы какого-то определённого стиля питания?" value="Гипоаллергенное" type="checkbox" /><span class="checkmark"></span>Гипоаллергенное</label>
        <label class="checkbox-container"><input name="Придерживаетесь ли вы какого-то определённого стиля питания?" value="Безлактозное (не ем молочные продукты)" type="checkbox" /><span class="checkmark"></span>Безлактозное (не ем молочные продукты)</label>
        <label class="checkbox-container"><input name="Придерживаетесь ли вы какого-то определённого стиля питания?" value="Безглютеновое (не ем пшеницу, мучные изделия и другие продукты, содержащие глютен)" type="checkbox" /><span class="checkmark"></span>Безглютеновое (не ем пшеницу, мучные изделия и другие продукты, содержащие глютен)</label>
        <label class="checkbox-container"><input name="Придерживаетесь ли вы какого-то определённого стиля питания?" value="Не придерживаюсь" type="checkbox" /><span class="checkmark"></span>Не придерживаюсь</label>
        <label class="checkbox-container"><input name="Придерживаетесь ли вы какого-то определённого стиля питания?" value="Другое" type="checkbox" /><span class="checkmark"></span>Другое</label>
      </div>
      <div class="question" id="question2-1" onchange="saveCookie()">
        <label><input name="Придерживаетесь ли вы какого-то определённого стиля питания?" type="text" value="" placeholder="Ваш вариант ответа (краткий ответ)" /></label>
      </div>
    </div>

    <div class="input-group custom-validation">
      <div class="title">Сколько часов вы обычно спите?</div>
      <div class="question" id="question3" onchange="saveCookie()">
        <label class="radio-container"><input name="Сколько часов вы обычно спите?" value="Менее 7 часов" type="radio" /><span class="checkmark"></span>Менее 7 часов</label>
        <label class="radio-container"><input name="Сколько часов вы обычно спите?" value="7-8 часов" type="radio" /><span class="checkmark"></span>7-8 часов</label>
        <label class="radio-container"><input name="Сколько часов вы обычно спите?" value="Более 8 часов" type="radio"/><span class="checkmark"></span>Более 8 часов</label>
      </div>
    </div>

    <div class="input-group custom-validation">
      <div class="title">Курите ли вы?</div>
      <div class="question" id="question4" onchange="saveCookie()">
        <label class="radio-container"><input name="Курите ли вы?" value="Не курю" type="radio" /><span class="checkmark"></span>Не курю</label>
        <label class="radio-container"><input name="Курите ли вы?" value="Больше 1 пачки сигарет в день" type="radio" /><span class="checkmark"></span>Больше 1 пачки сигарет в день</label>
        <label class="radio-container"><input name="Курите ли вы?" value="Примерно 1 пичку сигарет в день" type="radio"/><span class="checkmark"></span>Примерно 1 пичку сигарет в день</label>
        <label class="radio-container"><input name="Курите ли вы?" value="1-3 сигареты в день" type="radio"/><span class="checkmark"></span>1-3 сигареты в день</label>
        <label class="radio-container"><input name="Курите ли вы?" value="Курю редко" type="radio"/><span class="checkmark"></span>Курю редко</label>
      </div>
    </div>

    <div class="input-group custom-validation">
      <div class="title">Употребляете ли вы алкогольные напитки?</div>
      <div class="question" id="question5" onchange="saveCookie()">
        <label class="radio-container"><input name="Употребляете ли вы алкогольные напитки?" value="Ежедневно" type="radio" /><span class="checkmark"></span>Ежедневно</label>
        <label class="radio-container"><input name="Употребляете ли вы алкогольные напитки?" value="На выходных" type="radio" /><span class="checkmark"></span>На выходных</label>
        <label class="radio-container"><input name="Употребляете ли вы алкогольные напитки?" value="По праздникам" type="radio"/><span class="checkmark"></span>По праздникам</label>
        <label class="radio-container"><input name="Употребляете ли вы алкогольные напитки?" value="Не употребляю" type="radio"/><span class="checkmark"></span>Не употребляю</label>
      </div>
    </div>

    <div class="input-group custom-validation">
      <div class="title">Какие жалобы на здоровье у вас есть на текущий момент?</div>
      <div class="question" id="question6" onchange="saveCookie()">
        <label><input name="Какие жалобы на здоровье у вас есть на текущий момент?" type="text" value="" placeholder="Длинный вариант ответа"/></label>
      </div>
    </div>

    <div class="input-group custom-validation">
      <div class="title">Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию</div>
      <div class="question" id="question7" onchange="saveCookie()">
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Заболевания почек/печени" type="checkbox" /><span class="checkmark"></span>Заболевания почек/печени</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Прием антибактериальных препаратов за последние 6 мес" type="checkbox" /><span class="checkmark"></span>Прием антибактериальных препаратов за последние 6 мес</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Иммунологические заболевания" type="checkbox" /><span class="checkmark"></span>Иммунологические заболевания</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Аллергические реакции" type="checkbox" /><span class="checkmark"></span>Аллергические реакции</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Диабет" type="checkbox" /><span class="checkmark"></span>Диабет</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Применение витамина А (роаккутан, акнекутан) за последние 6 мес" type="checkbox" /><span class="checkmark"></span>Применение витамина А (роаккутан, акнекутан) за последние 6 мес</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Проблемы с желудком/ кишечником" type="checkbox" /><span class="checkmark"></span>Проблемы с желудком/ кишечником</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Частые острые респираторные заболевания" type="checkbox" /><span class="checkmark"></span>Частые острые респираторные заболевания</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Хронический тонзиллит, фарингит, синусит" type="checkbox" /><span class="checkmark"></span>Хронический тонзиллит, фарингит, синусит</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Болезни сердца/ сердечно-сосудистой системы" type="checkbox" /><span class="checkmark"></span>Болезни сердца/ сердечно-сосудистой системы</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Онкологические заболевания / после лечения" type="checkbox" /><span class="checkmark"></span>Онкологические заболевания / после лечения</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Дерматиты (высыпания)" type="checkbox" /><span class="checkmark"></span>Дерматиты (высыпания)</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Усиленное выпадение волос -алопеция" type="checkbox" /><span class="checkmark"></span>Усиленное выпадение волос -алопеция</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Заболевания ногтей" type="checkbox" /><span class="checkmark"></span>Заболевания ногтей</label>
        <label class="checkbox-container"><input name="Пожалуйста, поставьте галочку возле пункта, который соответствует вашему состоянию" value="Неврологическия симптомы (стрессы, частые головные боли, боли в шее и спине, «ком» в горле)" type="checkbox" /><span class="checkmark"></span>Неврологическия симптомы (стрессы, частые головные боли, боли в шее и спине, «ком» в горле)</label>
      </div>
    </div>

    <div class="input-group custom-validation">
      <div class="title">Состояния кожи и ее придатков, которые беспокоят на данный момент: </div>
      <div class="question" id="question8" onchange="saveCookie()">
        <label class="checkbox-container"><input name="Состояния кожи и ее придатков, которые беспокоят на данный момент:" value="Сосудистые звездочки" type="checkbox" /><span class="checkmark"></span>Сосудистые звездочки</label>
        <label class="checkbox-container"><input name="Состояния кожи и ее придатков, которые беспокоят на данный момент:" value="Высыпания" type="checkbox" /><span class="checkmark"></span>Высыпания</label>
        <label class="checkbox-container"><input name="Состояния кожи и ее придатков, которые беспокоят на данный момент:" value="Рубцы" type="checkbox" /><span class="checkmark"></span>Рубцы</label>
        <label class="checkbox-container"><input name="Состояния кожи и ее придатков, которые беспокоят на данный момент:" value="Пигментные пятна" type="checkbox" /><span class="checkmark"></span>Пигментные пятна</label>
        <label class="checkbox-container"><input name="Состояния кожи и ее придатков, которые беспокоят на данный момент:" value="Тусклый цвет кожи" type="checkbox" /><span class="checkmark"></span>Тусклый цвет кожи</label>
        <label class="checkbox-container"><input name="Состояния кожи и ее придатков, которые беспокоят на данный момент:" value="Морщины" type="checkbox" /><span class="checkmark"></span>Морщины</label>
        <label class="checkbox-container"><input name="Состояния кожи и ее придатков, которые беспокоят на данный момент:" value="Повышенная потливость" type="checkbox" /><span class="checkmark"></span>Повышенная потливость</label>
        <label class="checkbox-container"><input name="Состояния кожи и ее придатков, которые беспокоят на данный момент:" value="Выпадение волос" type="checkbox" /><span class="checkmark"></span>Выпадение волос</label>
        <label class="checkbox-container"><input name="Состояния кожи и ее придатков, которые беспокоят на данный момент:" value="Ломкость ногтей" type="checkbox" /><span class="checkmark"></span>Ломкость ногтей</label>
      </div>
      <div class="question" id="question8-1" onchange="saveCookie()">
        <label>Перечислите средства домашнего ухода, которые используете для кожи лица, волос<textarea name="Состояния кожи и ее придатков, которые беспокоят на данный момент:" rows="5"></textarea></label>
      </div>
    </div>

    <div class="input-group custom-validation">
      <div class="title">Проводимое ранее лечение в дерматологии и косметологии (лекарственные препараты, крема/мази, наружные процедуры, инъекции, аппараты)</div>
      <div class="question" id="question9" onchange="saveCookie()">
        <label><input name="Проводимое ранее лечение в дерматологии и косметологии (лекарственные препараты, крема/мази, наружные процедуры, инъекции, аппараты)" type="text" value="" placeholder="Длинный вариант ответа"/></label>
      </div>
    </div>

    <div class="input-group custom-validation">
      <div class="title">Принимаете ли данный момент лекарственные препараты, витамины, минералы, нутрицевтики? Если да, то какие</div>
      <div class="question" id="question10" onchange="saveCookie()">
        <label><input name="Принимаете ли данный момент лекарственные препараты, витамины, минералы, нутрицевтики? Если да, то какие" type="text" value="" placeholder="Длинный вариант ответа"/></label>
      </div>
    </div>


    <div class="input-group custom-validation">
      <div class="title">Как часто принимаете  фастфуды, газированные напитки, сладкое,мучное</div>
      <div class="question" id="question11" onchange="saveCookie()">
        <label class="radio-container"><input name="Как часто принимаете  фастфуды, газированные напитки, сладкое,мучное" value="1 раз в день" type="radio" /><span class="checkmark"></span>1 раз в день</label>
        <label class="radio-container"><input name="Как часто принимаете  фастфуды, газированные напитки, сладкое,мучное" value="1 раз в неделю" type="radio" /><span class="checkmark"></span>1 раз в неделю</label>
        <label class="radio-container"><input name="Как часто принимаете  фастфуды, газированные напитки, сладкое,мучное" value="1 раз в 2-3 недели" type="radio"/><span class="checkmark"></span>1 раз в 2-3 недели</label>
        <label class="radio-container"><input name="Как часто принимаете  фастфуды, газированные напитки, сладкое,мучное" value="1 раз в месяц" type="radio"/><span class="checkmark"></span>1 раз в месяц</label>
        <label class="radio-container"><input name="Как часто принимаете  фастфуды, газированные напитки, сладкое,мучное" value="1 раз в 6 мес" type="radio"/><span class="checkmark"></span>1 раз в 6 мес</label>
        <label class="radio-container"><input name="Как часто принимаете  фастфуды, газированные напитки, сладкое,мучное" value="не питаюсь подобными продуктами" type="radio"/><span class="checkmark"></span>не питаюсь подобными продуктами</label>
      </div>
    </div>

    <div class="submit">
      <input type="submit" class="button" value="Отправить" />
    </div>
  </form>
</div>

<script>

	var productOrderCookieId = getURLParameter("productOrderId")

	function saveCookie () {
		let productOrderList = getURLParameterCookie(productOrderCookieId)
		productOrderList = productOrderList ? JSON.parse(productOrderList) : {}
		const value = event.target.value
		const currentTargetId = event.currentTarget.id
		const targetType = event.target.type
		let profileList = Object.assign({}, productOrderList)
		if (profileList[currentTargetId] && profileList[currentTargetId].length) {
			if (targetType !== 'checkbox') {
				profileList[currentTargetId] = [value]
			} else {
				if (profileList[currentTargetId].includes(value)) {
					profileList[currentTargetId] = profileList[currentTargetId].filter(v => v !== value)
				} else {
					profileList[currentTargetId] = [value, ...profileList[currentTargetId]]
				}
			}
		} else {
			profileList[currentTargetId] = [value]
		}
		var stringifyProfile = JSON.stringify(profileList)
		document.cookie = `${productOrderCookieId}=${stringifyProfile}; max-age=86400`
	}

	function getURLParameterCookie(name) {
		if (name) {
			let matches = document.cookie.match(new RegExp(
				"(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
			));
			return matches ? matches[1] : undefined;
		}
		return undefined
	}


	function getCookie () {
		let productOrderList = getURLParameterCookie(productOrderCookieId)
		let questions = document.querySelectorAll('.question')
		questions = Array.from(questions)
		if (productOrderList) {
			productOrderList = JSON.parse(productOrderList)
			questions.forEach(question => {
				let questionId = question.id
				let inputList = question.querySelectorAll('input')
        let textareaList = question.querySelectorAll('textarea')

				if (textareaList.length) {
					textareaList = Array.from(textareaList)
					textareaList.forEach(textarea => {
						if (productOrderList && productOrderList[questionId] && productOrderList[questionId].length) {
							textarea.value = productOrderList[questionId][0]
            }
          })
        }

        if (inputList.length) {
					inputList = Array.from(inputList)
					inputList.forEach(input => {
						if (productOrderList && productOrderList[questionId] && productOrderList[questionId].length) {
							if ((input.type === 'checkbox' || input.type === 'radio') && productOrderList[questionId].includes(input.value)) {
								input.checked = true
							} else if (input.type === 'text' || input.type === 'number') {
								input.value = productOrderList[questionId][0]
							}
						}
					})
        }

			})
		}
	}

	getCookie()

  function scrollToWarning () {
		const warning = document.querySelector('.warning')
    if (warning) {
			warning.scrollIntoView({block: "start", behavior: "smooth"})
    }
  }

	let requiredCheckBox = document.querySelectorAll('.custom-validation')
	const form = document.querySelector('.form-horizontal')
  function testChecked () {
		requiredCheckBox = Array.from(requiredCheckBox)
		return requiredCheckBox.map(x => {
			let input = x.querySelectorAll('label > input')
			input = Array.from(input)
			const check = input.some(x => {
        if (x.type === 'text' || x.type === 'number') {
					x.checked = x.value ? true : false
        }
				return x.checked
      })
      if (!check) {
				x.classList.add("warning")
      } else {
				x.classList.remove("warning")
      }
			scrollToWarning ()
      return check
		})
  }



	form.addEventListener('submit', evt => {
		evt.preventDefault()
    let isSomeInputChecked = testChecked().every(x => x === true)
		if (isSomeInputChecked) {
			evt.target.submit()
		}
	})


	function maxLengthCheck(object)
	{
		if (object.value.length > 3)
			object.value = object.value.slice(0, 3)
	}

	(function() {
		changeInputByName('personId');
		changeInputByName('productId');
		changeInputByName('productOrderId');
	})();

	function changeInputByName(name) {
		let el = document.getElementsByName(name)[0];
		el.value = getURLParameter(name);
		el.dispatchEvent(new Event("change"));
	}

	function getURLParameter(sParam) {
		var sPageURL = window.location.search.substring(1);
		var sURLVariables = sPageURL.split('&');
		for (var i = 0; i < sURLVariables.length; i++){
			var sParameterName = sURLVariables[i].split('=');
			if (sParameterName[0] === sParam){
				return sParameterName[1];
			}
		}
		return null;
	}

</script>

</body>
</html>
